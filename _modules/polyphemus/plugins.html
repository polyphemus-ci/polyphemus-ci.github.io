


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>polyphemus.plugins &mdash; polyphemus 0.1-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/numpy_friendly.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../../_static/polyphemus.ico"/>
    <link rel="top" title="polyphemus 0.1-dev documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">polyphemus 0.1-dev documentation</a> &raquo;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for polyphemus.plugins</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;This module provides the architecture for creating and handling plugins.</span>

<span class="sd">The purpose of polyphemus is to be as modular and extensible as possible, allowing for </span>
<span class="sd">developers to build and execute their own tools as needed.  As such, polyphemus has </span>
<span class="sd">a very nimble plugin interface that easily handles run control, adding arguments to </span>
<span class="sd">the command line interface, setting up &amp; validating the run control, command</span>
<span class="sd">execution, and teardown.  In fact, the entire polyphemus execution is based on this </span>
<span class="sd">plugin architecture.  You can be certain that this is well supported feature and </span>
<span class="sd">not some hack&#39;d add on.</span>

<span class="sd">Writing Plugins</span>
<span class="sd">===============</span>
<span class="sd">Writing plugins is easy!  You simply need to have a variable named ``PolyphemusPlugin``</span>
<span class="sd">in a module.  Say your module is called ``mymod`` and lives in a package ``mypack``,</span>
<span class="sd">then polyphemus would know this plugin by the name ``&quot;mypack.mymod&quot;``.  This is </span>
<span class="sd">exactly the same string that you would use to do an absolute import of ``mymod``.</span>

<span class="sd">To expose this plugin to an polyphemus execution, either add it to the ``plugins``</span>
<span class="sd">variable in your ``polyphemusrc.py`` file::</span>

<span class="sd">    from polypheums.utils import DEFAULT_PLUGINS</span>
<span class="sd">    plugins = list(DEFAULT_PLUGINS) + [&#39;mypack.mymod&#39;]</span>

<span class="sd">Or you can add it on the command line::</span>

<span class="sd">    ~ $ polyphemus --plugins polyphemus.base mypack.mymod</span>

<span class="sd">Note that in both of the above cases we retain normal functionality by including </span>
<span class="sd">the default plugins that come with polyphemus.</span>

<span class="sd">The ``PolyphemusPlugin`` variable must be callable with no arguments and return a </span>
<span class="sd">variable with certain attributes.  Normally this is done as a class but through</span>
<span class="sd">the magic of duck typing it doesn&#39;t have to be.  The ``Plugin`` class is provided</span>
<span class="sd">as a base class which implements a minimal, zero-work interface.  This is useful</span>
<span class="sd">for inheriting your modules plugin from.  You need only override the attributes</span>
<span class="sd">you want.  Again, inheriting from ``Plugin`` is suggested but not required.</span>

<span class="sd">Interface</span>
<span class="sd">---------</span>
<span class="sd">:requires: This is a list of module names or a function that returns such a list.</span>
<span class="sd">    The names in this list will be loaded and executed in order prior to this plugin.</span>
<span class="sd">    If multiple plugins require the same upstream plugin, the upstream on will only</span>
<span class="sd">    be run once.</span>
<span class="sd">:defaultrc: This is a dictionary or run control instance that maps run control </span>
<span class="sd">    parameters to their default values if they are otherwise not specified.  To </span>
<span class="sd">    make a parameter have to be given by the user, set the value to the singleton</span>
<span class="sd">    ``polyphemus.utils.NotSpecified``.  Parameters with the same name in different </span>
<span class="sd">    plugins will clobber each other, with the last plugin&#39;s value being ultimately</span>
<span class="sd">    assigned.  The exception to this is if a later plugin&#39;s parameter value is </span>
<span class="sd">    ``NotSpecified`` then the previous plugin value will be retained.  See the</span>
<span class="sd">    ``RunControl`` class for more details.  Generally it is not advised for two</span>
<span class="sd">    plugins to share run control parameter names unless you *really* know what </span>
<span class="sd">    you are doing.</span>
<span class="sd">:rcupdaters: This may be a dict, another mapping, a function which returns a mapping.</span>
<span class="sd">    The keys are the string names of the run control parameters.  The values</span>
<span class="sd">    are callables which indicate how to update or merge two rc parameters with </span>
<span class="sd">    this key. The callable should take two instances and return a copy that </span>
<span class="sd">    represents the merger, e.g. ``lambda old, new: old + new``.  One useful example </span>
<span class="sd">    is for paths.  Normally you want new paths to prepend old ones::</span>

<span class="sd">        rcupdaters = {&#39;includes&#39;: lambda old, new: list(new) + list(old)}</span>

<span class="sd">    If a callable is not supplied for an rc parameter then the the default </span>
<span class="sd">    behaviour is to simply override the old value with the new one.</span>
<span class="sd">:rcdocs: This may be a dict, another mapping, a function which returns a mapping.</span>
<span class="sd">    The keys are the string names of the run control parameters.  The values</span>
<span class="sd">    are docstrings for the rc parameters.</span>
<span class="sd">:update_argparser(parser):  This is method that takes an argparse.ArgumentParser() </span>
<span class="sd">    instance and modifies it in-place.  This allows for run control parameters to be </span>
<span class="sd">    exposed as command line arguments and options.  Default arguments in </span>
<span class="sd">    ``parser.add_argument()`` values should not be given, or should only be set to </span>
<span class="sd">    ``Not Specified``.  This is to prevent collisions with the run controller.  </span>
<span class="sd">    Default values should instead be given in the plugin&#39;s ``defaultrc``.  Thus </span>
<span class="sd">    argument names or the ``dest`` keyword argument should match the keys in </span>
<span class="sd">    ``defaultrc``.</span>
<span class="sd">:setup(rc): Performs all setup tasks needed for this plugin.  This may include </span>
<span class="sd">    validation and munging of the run control object (rc) as well as creating </span>
<span class="sd">    directories and files in the OS environment.  If needed, the rc should be </span>
<span class="sd">    modified in-place so that changes propagate to other plugins and further calls</span>
<span class="sd">    on this plugin. This should return None.</span>
<span class="sd">:execute(rc): Performs the heavy lifting of the plugin, which may require a run </span>
<span class="sd">    controller.If needed, the rc should be modified in-place so that changes </span>
<span class="sd">    propagate to other plugins and further calls on this plugin. This should </span>
<span class="sd">    return None. </span>
<span class="sd">:teardown(rc): Performs any cleanup tasks needed by the plugin, including removing</span>
<span class="sd">    temporary files.  If needed, the rc should be modified in-place so that changes </span>
<span class="sd">    propagate to other plugins and further calls on this plugin. This should </span>
<span class="sd">    return None. </span>
<span class="sd">:report_debug(rc):  Generates and returns a message to report in the ``debug.txt``</span>
<span class="sd">    file in the event that execute() fails and additional debugging information is </span>
<span class="sd">    requested.  This message is a string.</span>


<span class="sd">Example</span>
<span class="sd">-------</span>
<span class="sd">Here is simple, if morbid, plugin example::</span>

<span class="sd">    from polyphemus.plugins import Plugin</span>

<span class="sd">    class PolyphemusPlugin(Plugin):</span>
<span class="sd">        &#39;&#39;&#39;Which famous person was executed?&#39;&#39;&#39;</span>

<span class="sd">        # everything should require base, it is useful!</span>
<span class="sd">        requires = (&#39;polyphemus.base&#39;,)</span>

<span class="sd">        defaultrc = {</span>
<span class="sd">            &#39;choices&#39;: [&#39;J. Edgar Hoover&#39;, &#39;Hua Mulan&#39;, &#39;Leslie&#39;],</span>
<span class="sd">            &#39;answer&#39;: &#39;Joan of Arc&#39;,</span>
<span class="sd">            }</span>

<span class="sd">        rcupdaters = {&#39;choices&#39;: lambda old, new: list(new) + list(old)}        </span>

<span class="sd">        rcdocs = {&#39;choices&#39;: &quot;Possible answers.&quot;,</span>
<span class="sd">                  &#39;answer&#39;: &quot;The correct answer&quot;}</span>

<span class="sd">        def update_argparser(self, parser):</span>
<span class="sd">            # Note, no &#39;default=&#39; keyword arguments are given</span>
<span class="sd">            parser.add_argument(&#39;-c&#39;, &#39;--choices&#39;, action=&#39;store&#39;, dest=&#39;choices&#39;,</span>
<span class="sd">                                nargs=&quot;+&quot;, help=&quot;famous people chocies&quot;)</span>
<span class="sd">            parser.add_argument(&#39;-a&#39;, &#39;--answer&#39;, action=&#39;store&#39;, dest=&#39;answer&#39;,</span>
<span class="sd">                                help=&quot;person who was executed&quot;)</span>

<span class="sd">        def setup(self, rc):</span>
<span class="sd">            &#39;&#39;&#39;Ensures that Joan of Arc is a choice.&#39;&#39;&#39;</span>
<span class="sd">            if &#39;Joan of Arc&#39; not in rc.choices:</span>
<span class="sd">                rc.choices.append(&#39;Joan of Arc&#39;)</span>

<span class="sd">        def execute(self, rc):</span>
<span class="sd">            &#39;&#39;&#39;Kills Joan...&#39;&#39;&#39;</span>
<span class="sd">            if rc.answer == &#39;Joan of Arc&#39;:</span>
<span class="sd">                print(&#39;Joan has met an untimely demise!&#39;)</span>
<span class="sd">            else:</span>
<span class="sd">                raise ValueError(&#39;Joan of Arc was executed, not &#39; + rc.answer)</span>

<span class="sd">        def report_debug(self, rc):</span>
<span class="sd">            return &quot;the possible choices were &quot; + str(rc.choices)</span>
<span class="sd">    </span>

<span class="sd">Plugins API</span>
<span class="sd">===========</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">RunControl</span><span class="p">,</span> <span class="n">NotSpecified</span><span class="p">,</span> <span class="n">nyansep</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">basestring</span> <span class="o">=</span> <span class="nb">str</span>

<div class="viewcode-block" id="Plugin"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin">[docs]</a><span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base plugin for other polyphemus pluigins to inherit.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;This is a sequence of strings, or a function which returns such, that </span>
<span class="sd">    lists the module names of other plugins that this plugin requires.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">defaultrc</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="sd">&quot;&quot;&quot;This may be a dict, RunControl instance, or other mapping or a function</span>
<span class="sd">    which returns any of these.  The keys are string names of the run control </span>
<span class="sd">    parameters and the values are the associated default values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rcupdaters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="sd">&quot;&quot;&quot;This may be a dict, another mapping, a function which returns a mapping.</span>
<span class="sd">    The keys are the string names of the run control parameters.  The values</span>
<span class="sd">    are callables which indicate how to update or merge two rc parameters with </span>
<span class="sd">    this key. The callable should take two instances and return a copy that </span>
<span class="sd">    represents the merger, e.g. ``lambda old, new: old + new``.  One useful example </span>
<span class="sd">    is for paths.  Normally you want new paths to prepend old ones::</span>

<span class="sd">        rcupdaters = {&#39;includes&#39;: lambda old, new: list(new) + list(old)}</span>

<span class="sd">    If a callable is not supplied for an rc parameter then the the default </span>
<span class="sd">    behaviour is to simply override the old value with the new one.  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rcdocs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="sd">&quot;&quot;&quot;This may be a dict, another mapping, a function which returns a mapping.</span>
<span class="sd">    The keys are the string names of the run control parameters.  The values</span>
<span class="sd">    are docstrings for the rc parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">route</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;This is the route (relative url) that the web appliction associates </span>
<span class="sd">    with the plugin. These should start with a slash &#39;/&#39;.  For example, </span>
<span class="sd">    the route &#39;/about&#39; would be accessed as &#39;http://localhost/about&#39;.  If the</span>
<span class="sd">    route is set to None this plugin is not treated as a web service.</span>
<span class="sd">    See the flask documentation for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">request_methods</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,)</span>
    <span class="sd">&quot;&quot;&quot;This is a list of the valid requests types that the plugin responds to.</span>
<span class="sd">    For normal pages and services, only &#39;GET&#39; is required.  For responses accepting</span>
<span class="sd">    data &#39;POST&#39; is also needed.  See the flask documentation for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The __init__() method may take no arguments or keyword arguments.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Plugin.update_argparser"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin.update_argparser">[docs]</a>    <span class="k">def</span> <span class="nf">update_argparser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method takes an argparse.ArgumentParser() instance and modifies </span>
<span class="sd">        it in-place.  This allows for run control parameters to be modified from </span>
<span class="sd">        as command line arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parser : argparse.ArgumentParser</span>
<span class="sd">            The parser to be updated.  Arguments defaults should not be given, or</span>
<span class="sd">            if given should only be ``polyphemus.utils.Not Specified``.  This is to </span>
<span class="sd">            prevent collisions with the run controller.  Default values should </span>
<span class="sd">            instead be given in this class&#39;s ``defaultrc`` attribute or method.</span>
<span class="sd">            Argument names or the ``dest`` keyword argument should match the keys </span>
<span class="sd">            in ``defaultrc``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Plugin.setup"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs all setup tasks needed for this plugin.  This may include </span>
<span class="sd">        validation and munging of the run control object as well as creating </span>
<span class="sd">        the portions of the OS environment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rc : polyphemus.utils.RunControl</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Plugin.response"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin.response">[docs]</a>    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Responds to any requests from the web application. </span>
<span class="sd">        See the flask documentation for more details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rc : polyphemus.utils.RunControl</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        resp : str</span>
<span class="sd">            Any information requested. For web pages, this is nominally HTML.</span>
<span class="sd">        event : Event or None</span>
<span class="sd">            The event that is generated by processing this request.  This </span>
<span class="sd">            event will automatically be set to rc.event and may be handled</span>
<span class="sd">            by any plugin&#39;s execute() method.  This is most useful for responses</span>
<span class="sd">            from POST requests.  The event returned may be None in which case the</span>
<span class="sd">            execution pipeline will not be triggered.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Plugin.execute"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the actual work of the plugin, which may require a run controller.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rc : polyphemus.utils.RunControl</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Plugin.teardown"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin.teardown">[docs]</a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs any cleanup tasks needed by the plugin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rc : polyphemus.utils.RunControl</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Plugin.report_debug"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugin.report_debug">[docs]</a>    <span class="k">def</span> <span class="nf">report_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A message to report in the event that execute() fails and additional</span>
<span class="sd">        debugging information is requested.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rc : polyphemus.utils.RunControl</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        message : str or None</span>
<span class="sd">            A debugging message to report.  If None is returned, this plugin is </span>
<span class="sd">            skipped in the debug output.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div></div>
<div class="viewcode-block" id="Plugins"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins">[docs]</a><span class="k">class</span> <span class="nc">Plugins</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a class for managing the instantiation and execution of plugins.</span>

<span class="sd">    The execution and control of plugins should happen in the following order:</span>

<span class="sd">    1. ``build_cli()``</span>
<span class="sd">    2. ``merge_rcs()``</span>
<span class="sd">    3. ``setup()``</span>
<span class="sd">    4. ``execute()`` OR ``run_app()``</span>
<span class="sd">    5. ``teardown()``</span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modnames</span><span class="p">,</span> <span class="n">loaddeps</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        modnames : list of str</span>
<span class="sd">            The module names where the plugins live.  Plugins must have the name</span>
<span class="sd">            &#39;PolyphemusPlugin&#39; in the these modules.</span>
<span class="sd">        loaddeps: bool, optional</span>
<span class="sd">            Flag for automatically loading dependencies, should only be False in </span>
<span class="sd">            a limited set of circumstances.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">(</span><span class="n">modnames</span><span class="p">,</span> <span class="n">loaddeps</span><span class="o">=</span><span class="n">loaddeps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rcdocs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modnames</span><span class="p">,</span> <span class="n">loaddeps</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">modname</span> <span class="ow">in</span> <span class="n">modnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modnames</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
            <span class="n">plugin</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">PolyphemusPlugin</span><span class="p">()</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">requires</span><span class="p">()</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">requires</span><span class="p">)</span> <span class="k">else</span> <span class="n">plugin</span><span class="o">.</span><span class="n">requires</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">req</span> <span class="k">if</span> <span class="n">loaddeps</span> <span class="k">else</span> <span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">loaddeps</span><span class="o">=</span><span class="n">loaddeps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

<div class="viewcode-block" id="Plugins.build_cli"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.build_cli">[docs]</a>    <span class="k">def</span> <span class="nf">build_cli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds and returns a command line interface based on the plugins.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        parser : argparse.ArgumentParser</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="s">&quot;Polyphemus CI&quot;</span><span class="p">,</span>
                    <span class="n">conflict_handler</span><span class="o">=</span><span class="s">&#39;resolve&#39;</span><span class="p">,</span> <span class="n">argument_default</span><span class="o">=</span><span class="n">NotSpecified</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="n">plugin</span><span class="o">.</span><span class="n">update_argparser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="k">return</span> <span class="n">parser</span>
</div>
    <span class="k">def</span> <span class="nf">_setshowwarning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">showwarning</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">debugmsg</span> <span class="o">=</span> <span class="s">&quot;{0}: &#39;{1}&#39; from {2}:{3}&quot;</span>
                <span class="n">debugmsg</span> <span class="o">=</span> <span class="n">debugmsg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> 
                                           <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">debugmsg</span><span class="p">)</span>
            <span class="n">printmsg</span> <span class="o">=</span> <span class="s">&quot;WARNING: {0}: {1}&quot;</span>
            <span class="n">printmsg</span> <span class="o">=</span> <span class="n">printmsg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">printmsg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">showwarning</span> <span class="o">=</span> <span class="n">showwarning</span>

<div class="viewcode-block" id="Plugins.merge_rcs"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.merge_rcs">[docs]</a>    <span class="k">def</span> <span class="nf">merge_rcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds all of the default run controllers and returns a new and </span>
<span class="sd">        full default RunControl() instance.  This has also merged all of </span>
<span class="sd">        the rc updaters in the process.&quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">RunControl</span><span class="p">()</span>
        <span class="n">rcdocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcdocs</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="n">drc</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">defaultrc</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">drc</span><span class="p">):</span>
                <span class="n">drc</span> <span class="o">=</span> <span class="n">drc</span><span class="p">()</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">drc</span><span class="p">)</span>
            <span class="n">uprc</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">rcupdaters</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">uprc</span><span class="p">):</span>
                <span class="n">uprc</span> <span class="o">=</span> <span class="n">uprc</span><span class="p">()</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">_updaters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">uprc</span><span class="p">)</span>
            <span class="n">docs</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">rcdocs</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
                <span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span><span class="p">()</span>
            <span class="n">rcdocs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc</span> <span class="o">=</span> <span class="n">rc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setshowwarning</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rc</span>
</div>
<div class="viewcode-block" id="Plugins.setup"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs all plugin setup tasks.&quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
                <span class="n">plugin</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plugins.execute"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Preforms all plugin executions.&quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
                <span class="n">plugin</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plugins.build_app"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.build_app">[docs]</a>    <span class="k">def</span> <span class="nf">build_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a default flask application.&quot;&quot;&quot;</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">appname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">route</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">wrap_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">route</span><span class="p">,</span> <span class="n">plugin</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> 
                             <span class="n">methods</span><span class="o">=</span><span class="n">plugin</span><span class="o">.</span><span class="n">request_methods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
</div>
<div class="viewcode-block" id="Plugins.run_app"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.run_app">[docs]</a>    <span class="k">def</span> <span class="nf">run_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs, and possibly builds, the flask web application.&quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span>
        <span class="k">if</span> <span class="s">&#39;app&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_app</span><span class="p">()</span>
        <span class="n">rc</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">rc</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">rc</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">rc</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plugins.teardown"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.teardown">[docs]</a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Preforms all plugin teardown tasks.&quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
                <span class="n">plugin</span><span class="o">.</span><span class="n">teardown</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plugins.exit"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.Plugins.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exits the process, possibly printing debug info.&quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span>
        <span class="k">if</span> <span class="n">rc</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">nyansep</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">u&#39;{0}polyphemus failed with the following error:</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnmsg</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">{0}polyphemus issued the following warnings:</span><span class="se">\n\n</span><span class="s">{1}</span><span class="se">\n\n</span><span class="s">&#39;</span>
                <span class="n">warnmsg</span> <span class="o">=</span> <span class="n">warnmsg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">))</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="n">warnmsg</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">{0}Run control run-time contents:</span><span class="se">\n\n</span><span class="s">{1}</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> 
                                                                    <span class="n">rc</span><span class="o">.</span><span class="n">_pformat</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
                <span class="n">plugin_msg</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">report_debug</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">plugin_msg</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="n">sep</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="n">plugin_msg</span>
            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">debug_filename</span><span class="p">),</span> <span class="s">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="summarize_rcdocs"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.summarize_rcdocs">[docs]</a><span class="k">def</span> <span class="nf">summarize_rcdocs</span><span class="p">(</span><span class="n">modnames</span><span class="p">,</span> <span class="n">headersep</span><span class="o">=</span><span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="n">maxdflt</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For a list of plugin module names, return a rST string that </span>
<span class="sd">    summarizes the docstrings for all run control parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nods</span> <span class="o">=</span> <span class="s">&quot;No docstring provided.&quot;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s">&quot;:{0!s}: {1!s}, *default:* {2}.&quot;</span>
    <span class="n">docstrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tw</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">modname</span> <span class="ow">in</span> <span class="n">modnames</span><span class="p">:</span>
        <span class="n">moddoc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
        <span class="n">moddoc</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">+</span> <span class="n">headersep</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">moddoc</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="n">Plugins</span><span class="p">([</span><span class="n">modname</span><span class="p">],</span> <span class="n">loaddeps</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c"># get a lone plugin</span>
        <span class="n">plugins</span><span class="o">.</span><span class="n">merge_rcs</span><span class="p">()</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">rc</span>
        <span class="n">rcdocs</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">rcdocs</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">dflt</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">rdflt</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">dflt</span><span class="p">)</span>
            <span class="n">rdflt</span> <span class="o">=</span> <span class="n">rdflt</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdflt</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maxdflt</span> <span class="k">else</span> <span class="s">&quot;{0}.{1} instance&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">dflt</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">dflt</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">rcdoc</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">rcdocs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">nods</span><span class="p">),</span> <span class="n">rdflt</span><span class="p">)</span>
            <span class="n">moddoc</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">rcdoc</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">docstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moddoc</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">docstrs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="wrap_response"><a class="viewcode-back" href="../../api/plugins.html#polyphemus.plugins.wrap_response">[docs]</a><span class="k">def</span> <span class="nf">wrap_response</span><span class="p">(</span><span class="n">plugins</span><span class="p">,</span> <span class="n">plugin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator-like function for wrapping plugin responses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    plugins : Plugins</span>
<span class="sd">        The plugins objects from which to take the run controler and </span>
<span class="sd">        the execution pipeline.</span>
<span class="sd">    plugin : Plugin</span>
<span class="sd">        The plugin object from which to take the response method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    response : function</span>
<span class="sd">        The response proxy function that is bound to plugins and plugin.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">response</span><span class="p">():</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">event</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="n">plugins</span><span class="o">.</span><span class="n">rc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plugins</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">event</span>
            <span class="n">plugins</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resp</span>
    <span class="k">return</span> <span class="n">response</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../index.html">
          <img class="logo" src="../../_static/polyphemus.gif" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">polyphemus 0.1-dev documentation</a> &raquo;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Anthony Scopatz.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>